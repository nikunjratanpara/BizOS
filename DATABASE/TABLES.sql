DROP TABLE GridColumnConfiguration
DROP TABLE SqlSourceConfiguration
DROP TABLE GridConfiguration
DROP TABLE FormFieldConfiguration
DROP TABLE FormConfiguration
DROP TABLE CatalogDictionary

CREATE TABLE CatalogDictionary
(
	CatalogId VARCHAR(20) CONSTRAINT PK_CatalogDictionary PRIMARY KEY,
	TableName VARCHAR(250),
	DisplayColumn VARCHAR(50),
	ValueColumn VARCHAR(50),
	Condition VARCHAR(1000),
	ObjectId RowVersion
)
CREATE TABLE FormConfiguration
(
	FormConfigId VARCHAR(20) NOT NULL CONSTRAINT PK_FormConfiguration PRIMARY KEY ,
	TableName VARCHAR(150) NOT NULL,
	GridConfigId VARCHAR(20),
	FormName VARCHAR(50) NOT NULL,
	RowId UniqueIdentifier NOT NULL,
	ObjectId RowVersion
)
CREATE TABLE FormFieldConfiguration
(
	FormConfigId VARCHAR(20) NOT NULL,
	[Name] VARCHAR(50) NOT NULL,
	Label VARCHAR(50) NOT NULL,
	[Type] VARCHAR(50) NOT NULL,
	Placeholder varchar(50),
	CatId VARCHAR(20) Constraint FK_FormFieldConfiguration_CatalogDictionary_CatId References CatalogDictionary(CatalogId) ,
	MaxDate Datetime,
	MinDate Datetime,
	DisplayFormat Varchar(23),
	IsRequired BIT,
	MaxValue VARCHAR(50),
	MinValue VARCHAR(50),
	Pattern VARCHAR(250),
	SearchOperator Varchar(20),
	IsPrimaryKey BIT,
	IsAutoGenerated	 BIT,
	IsUpdatable BIT, 
	ObjectId RowVersion,
	CONSTRAINT PK_FormFieldConfiguration PRIMARY KEY (FormConfigId, Name),
	CONSTRAINT UK_FormFieldConfiguration_FieldName UNIQUE (FormConfigId,Label),
)
CREATE TABLE GridConfiguration
(
	GridConfigId varchar(20) CONSTRAINT PK_GridConfiguration PRIMARY KEY,
	PageSize int,
	SearchConfigId varchar(20)  Constraint FK_GridConfiguration_FormConfiguration_SearchConfigId References FormConfiguration(FormConfigId),
	Url varchar(250),
	Method varchar(10),
	Params varchar(max),
	TableName varchar(max),
	ColumnList varchar(max)
)
CREATE TABLE SqlSourceConfiguration
(
	GridConfigId varchar(20) CONSTRAINT PK_SqlSourceConfiguration PRIMARY KEY Constraint FK_SqlSourceConfiguration_GridConfiguration References GridConfiguration(GridConfigId),
	SqlQuery varchar(max) NOT NULL,
	SqlSourceType int NOT NULL CHECK (SqlSourceType In(10,20)) DEFAULT 10,
	Condition VARCHAR(max)
)
CREATE TABLE GridColumnConfiguration
(
	GridConfigId varchar(20) CONSTRAINT FK_GridColConfiguration_GridConfiguration_GridConfigId REFERENCES GridConfiguration(GridConfigId),
	DataField Varchar(20) NOT NULL,
    DataType varchar(20) NOT NULL,
	Header varchar(150),
	Formatter VARCHAR(100),
    ColSpan int,
    DefaultValue varchar(20),
    CssClass Varchar(50),
    Sortable bit,
    SortOrder varchar(4),
    Width int,
    Align varchar(10),
	CONSTRAINT PK_GridColumnConfiguration PRIMARY KEY (GridConfigId,DataField)
)

insert into FormConfiguration (FormConfigId, TableName,FormName, GridConfigId, RowId) Values 
('CatCountry', 'CatCountry', 'Country', 'GrdCatCountry', NewId()),
('CatState', 'CatState', 'State', 'GrdCatState', NEWID()),
('CatCity', 'CatCity', 'City', 'GrdCatCity' ,NEWID()),
('CatCurrency', 'CatCurrency', 'Currency', 'GrdCatCurrency' ,NEWID()),
('CatStateSearch', 'CatState', 'State Search', NULL ,NEWID()),
('CatCountrySearch', 'CatCountry', 'Country Search', NULL ,NEWID()),
('CatCitySearch', 'CatCity', 'City Search', NULL ,NEWID()),
('CatCurrencySearch', 'CatCurrency', 'Currency Search', NULL ,NEWID())

Insert into CatalogDictionary (CatalogId, TableName, DisplayColumn, ValueColumn) values
	('CatCountry', 'CatCountry', 'Name', 'Code'),
	('CatCurrency', 'CatCurrency', 'Name', 'Code'),
	('CatState', 'CatState', 'Name', 'Id'),
	('CatCity', 'CatCity', 'Name', 'Id')
Insert into FormFieldConfiguration (FormConfigId,Name,Label,[Type],CatId,IsRequired,SearchOperator,IsPrimaryKey,IsAutoGenerated,IsUpdatable) 
	values ('CatCountry','name','Name','text',null,1,Null,0,0,1),
	('CatCountry','code','Country Code','text',null,1,Null,1,0,0),
	('CatCurrency','name','Currency Name','text',null,1,Null,0,0,1),
	('CatCurrency','code','Currency Code','text',null,1,Null,1,0,0),
	('CatCity','id','','hidden',null,1,Null,1,1,1),
	('CatCity','name','City Name','text',null,1,Null,0,0,1),
	('CatCity','stateId','State','datacombo','CatState',1,Null,0,0,1),
	('CatState','id','','hidden',null,1,Null,1,1,1),
	('CatState','name','State Name','text',null,1,Null,0,0,1),
	('CatState','country','Country','datacombo','CatCountry',1,Null,0,0,1),
	('CatStateSearch','name','State Name','text',null,null,'Like',0,0,1),
	('CatStateSearch','country','Country','datacombo','CatCountry',null,'=',0,0,1),
	('CatCountrySearch','name','Country Name','text',null,null,'Like',0,0,1),
	('CatCountrySearch','code','Country Code','datacombo','CatCountry',null,'=',0,0,1),
	('CatCurrencySearch','name','Currency Name','datacombo','CatCurrency',1,Null,0,0,1),
	('CatCurrencySearch','code','Currency Code','text',null,1,Null,1,0,0),
	('CatCitySearch','name','City Name','text',null,1,Null,0,0,1),
	('CatCitySearch','stateId','State','datacombo','CatState',1,Null,0,0,1)

INSERT INTO GridConfiguration (GridConfigId, SearchConfigId, PageSize, Url, Method, Params,TableName, ColumnList) Values
	('GrdCatState','CatStateSearch',20,'/DynamicGrid/GrdCatState','post',null,'CatState','Name,Country' ),
	('GrdCatCity','CatCitySearch',20,'/DynamicGrid/GrdCatCity','post',null,'CatCity','Name,Country' ),
	('GrdCatCountry','CatCountrySearch',20,'/DynamicGrid/GrdCatCountry','post',null,'CatCountry','Name,Code' ),
	('GrdCatCurrency','CatCurrencySearch',20,'/DynamicGrid/GrdCatCurrency','post',null,'CatCurrency','Name,Code' )

INSERT INTO SqlSourceConfiguration(GridConfigId,SqlQuery, SqlSourceType ) VALUES
	('GrdCatCity', 'select C.Id, C.Name, StateId, S.Name [StateName]  From CatCity C inner join CatState S on C.StateId = S.Id ',10),
	('GrdCatState', 'select S.Id, S.Name, S.Country, C.Name [CountryName] From CatState S inner join CatCountry C on S.Country = C.Code ',10)
INSERT INTO GridColumnConfiguration(ColSpan,Width,Sortable,GridConfigId,DataField,Datatype,Header,DefaultValue,CssClass,SortOrder,Align) 
			VALUES (6,null,1,'GrdCatState','name','string','State Name','',null,'Asc','center'),
				   (6,null,1,'GrdCatState','countryName','string','Country Name','',null,'Asc','center'),
				   (6,null,1,'GrdCatCity','name','string','City Name','',null,'Asc','center'),
				   (6,null,1,'GrdCatCity','stateName','string','State Name','',null,'Asc','center'),
				   (6,null,1,'GrdCatCountry','name','string','Country Name','',null,'Asc','center'),
				   (6,null,1,'GrdCatCountry','code','string','Code','',null,'Asc','center'),
				   (6,null,1,'GrdCatCurrency','name','string','Currency Name','',null,'Asc','center'),
				   (6,null,1,'GrdCatCurrency','code','string','Code','',null,'Asc','center')
